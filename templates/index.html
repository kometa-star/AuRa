<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AuRa</title>
    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="min-h-screen w-screen bg-gradient-to-br to-yellow-200 from-blue-500 pb-10">
      <div class=" flex h-12.5 w-full text-white font-bold sticky auto-rows-auto z-50 justify-between" alt="head title">
        <p class="font-family: px-5 pt-2 font-serif drop-shadow-lg opacity-70 text-2xl">AuRa</p>
        <div class="relative inline-block text-left mr-4 mt-2 opacity-85" x-data="{ open: false }">
    <!-- –ö–Ω–æ–ø–∫–∞ -->
        <button @click="open = !open"
              class="inline-flex justify-center w-full px-3 py-2 bg-gradient-to-b from-sky-500 text-white rounded-md hover:bg-sky-400 h-8">
      –Ø–∑—ã–∫–∏ ‚ñº
        </button>

    <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
        <div x-show="open"
           @click.away="open = false"
           class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded shadow-lg z-50 rounded-4xl">
          <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-200">–†—É—Å—Å–∫–∏–π</a>
          <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-200">English</a>
          <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-200">“ö–∞–∑–∞“õ—à–∞</a>
        </div>
    </div>
      </div>
      <div class="grid-rows-1 justify-evenly flex place" x-data="{ showCityInput: false }">
        <button @click="showCityInput = !showCityInput" class=" mx-20 my-5 w-full rounded-3xl bg-amber-50 h-10 text-center font-bold text-blue-600 transition hover:bg-sky-100 drop-shadow-2xl ease-in-out hover:scale-110">Location: {{ city }}</button>
        <div x-show="showCityInput" @click.away="showCityInput = false" class="absolute top-32 left-1/2 transform -translate-x-1/2 bg-white p-4 rounded-lg shadow-xl z-50">
          <form method="POST" action="/update_location">
            <input type="text" name="city" placeholder="Enter city name" class="border border-gray-300 rounded px-3 py-2 mr-2" required>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Search</button>
          </form>
        </div>
      </div>
      <div class="flex w-full grid-rows-2 font-semibold pb-5 content-center place-content-center gap-20" x-data="{ showDateInput: false }">
        <button @click="showDateInput = !showDateInput" class="w-40 h-10 rounded-full font-semibold bg-amber-50 text-blue-500 transition hover:bg-amber-200 drop-shadow-2xl ease-in-out hover:scale-110">Date: {{ current_date }}</button>
        <div x-show="showDateInput" @click.away="showDateInput = false" class="absolute top-40 left-1/2 transform -translate-x-1/2 bg-white p-4 rounded-lg shadow-xl z-50">
          <form method="POST" action="/update_date">
            <input type="date" name="date" class="border border-gray-300 rounded px-3 py-2 mr-2" required>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Update</button>
          </form>
        </div>
        <button id="live-time" class="w-40 h-10 rounded-full bg-amber-50 text-blue-600 transition hover:bg-amber-200 drop-shadow-2xl ease-in-out hover:scale-110">Time: {{ current_time }}</button>
      </div>
      <div class="" alt="icon"></div>
      <div class="flex gap-5 mx-40 content-center auto-rows-auto items-center justify-evenly">
        <div class="text-5xl flex-grow text-yellow-50 text-right">{{ forecast_data[0][0][0] }}¬∞C</div>
        <div class="flex-grow text-amber-50 transition">Scorching hot!ü•µ<br><p class="text-2xl">{{ condition }}</p></div>
      </div>
      <div class=" bg-color-50 bg-gradient-to-b from-yellow-50 to-transparent auto-cols-auto m-10 rounded-3xl p-4 px-8 flex-grow border border-amber-50 hover:bg-gradient-to-b hover:from-sky-100 hover:to-transparent transition duration-300">
        <div class="text-center mb-2 font-bold text-xl text-orange-300">Weather details</div>
        <div class="flex gap-2 items-stretch flex-wrap">
          <div class="flex-1 text-wrap bg-gradient-to-b from-amber-50 via-amber-50 to-transparent rounded-3xl p-4 text-lg text-blue-500 font-bold border border-amber-50"><p>Min Temp<br>{{ forecast_data[0][0][1] }}¬∞C</p></div>
          <div class="flex-1 text-wrap bg-gradient-to-b from-amber-50 via-amber-50 to-transparent rounded-3xl p-4 text-lg text-blue-500 font-bold border border-amber-50"><p>Max Temp<br>{{ forecast_data[0][0][2] }}¬∞C</p></div>
          <div class="flex-1 text-wrap bg-gradient-to-b from-amber-50 via-amber-50 to-transparent rounded-3xl p-4 text-lg text-blue-500 font-bold border border-amber-50"><p>Humidity<br>{{ forecast_data[0][0][3] }}%</p></div>
          <div class="flex-1 text-wrap bg-gradient-to-b from-amber-50 via-amber-50 to-transparent rounded-3xl p-4 text-lg text-blue-500 font-bold border border-amber-50"><p>Wind Speed<br>{{ forecast_data[0][0][4] }} k/h</p></div>
          <div class="flex-1 text-wrap bg-gradient-to-b from-amber-50 via-amber-50 to-transparent rounded-3xl p-4 text-lg text-blue-500 font-bold border border-amber-50"><p>Precipitation<br>{{ forecast_data[0][0][5] }} mm</p></div>
        </div>
        <div class="flex flex-grow flex-wrap auto-rows-auto gap-5 mt-5 place-content-center justify-center">
            <div class="flex-grow bg-gradient-to-b from-amber-50 via-amber-50 to-transparent h-full w-10 rounded-3xl p-4 text-lg text-orange-300 font-bold text-center border border-amber-50"><p>Sunrise<br>
              {{ forecast_data[0][0][6] }}</p></div>
            <div class="flex-grow bg-gradient-to-b from-amber-50 via-amber-50 to-transparent h-full w-10 rounded-3xl p-4 text-lg text-orange-300 font-bold text-center border border-amber-50">
              <p>Sunset<br>
                {{ forecast_data[0][0][7] }}</p>
            </div>
        </div>
      </div>

      <!-- Temperature Prediction Charts -->
      <div class="m-10 space-y-6">
        <div class="bg-gradient-to-b from-white to-transparent rounded-3xl p-6 border border-amber-50">
          <h3 class="text-center font-bold text-xl text-blue-600 mb-4">Average Temperature - 7 Day Forecast</h3>
          <canvas id="avgTempChart"></canvas>
        </div>
        
        <div class="bg-gradient-to-b from-white to-transparent rounded-3xl p-6 border border-amber-50">
          <h3 class="text-center font-bold text-xl text-blue-600 mb-4">Minimum Temperature - 7 Day Forecast</h3>
          <canvas id="minTempChart"></canvas>
        </div>
        
        <div class="bg-gradient-to-b from-white to-transparent rounded-3xl p-6 border border-amber-50">
          <h3 class="text-center font-bold text-xl text-blue-600 mb-4">Maximum Temperature - 7 Day Forecast</h3>
          <canvas id="maxTempChart"></canvas>
        </div>
      </div>
    </div>

    <script>
      // Real-time clock update
      function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('live-time').textContent = ` ${hours}:${minutes}`;
      }
      
      // Update clock every second
      setInterval(updateClock, 1000);
      updateClock(); // Initial call

      // Chart data from backend
      const labels = {{ chart_labels|safe }};
      const avgTemps = {{ avg_temps|safe }};
      const minTemps = {{ min_temps|safe }};
      const maxTemps = {{ max_temps|safe }};

      // Common chart options
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: false,
            ticks: {
              callback: function(value) {
                return value + '¬∞C';
              }
            }
          }
        }
      };

      // Average Temperature Chart
      new Chart(document.getElementById('avgTempChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Avg Temperature',
            data: avgTemps,
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: chartOptions
      });

      // Minimum Temperature Chart
      new Chart(document.getElementById('minTempChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Min Temperature',
            data: minTemps,
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: chartOptions
      });

      // Maximum Temperature Chart
      new Chart(document.getElementById('maxTempChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Max Temperature',
            data: maxTemps,
            borderColor: 'rgb(239, 68, 68)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: chartOptions
      });
    </script>
  </body>
</html>
